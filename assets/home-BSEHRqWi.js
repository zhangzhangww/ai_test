import{e as j,_ as z,f as l,g as N,h as O,n as q,c as i,a as o,d as E,i as f,v as U,F as C,j as T,k as F,l as J,o as r,t as P,m as B,p as k}from"./index-DBnJ76NE.js";import{m as x}from"./marked.esm-DK8KC6kv.js";const Y="/assets/bac1-DeIILTOM.png",$="/assets/aiIcon-fvBYh7Ir.png",G=j("userMsgStore",{persist:!0,state:()=>({list:[{role:"assistant",content:"你好！很高兴见到你。有什么我可以帮助你的吗？如果你有任何问题，请随时告诉我。我会尽力提供帮助。",reasoning_content:"",status:1}],maxContextLength:6}),getters:{formattedContext:e=>e.list.slice(-e.maxContextLength).map(s=>({role:s.role,content:s.content}))},actions:{userAddMsg(e){this.list.push({role:"user",content:e,reasoning_content:"",status:2})},clearMessages(){this.list=[{role:"assistant",content:"你好！很高兴见到你。有什么我可以帮助你的吗？如果你有任何问题，请随时告诉我。我会尽力提供帮助。",reasoning_content:"",status:1}]},addAssistantMessage(){this.list.push({role:"assistant",content:"",reasoning_content:"",status:1})},aiAddContent({content:e,reasoning_content:s}){const n=this.list[this.list.length-1];!n||n.role!=="assistant"||(n.content+=e||"",n.reasoning_content+=s||"")},completeAiMessage(){const e=this.list[this.list.length-1];!e||e.role!=="assistant"||(e.status=2,console.log(e.content),e.content=x(e.content),console.log(e.content))},clearPendingMessages(){this.list=this.list.filter(e=>e.status===2)}}}),K={class:"ai_content"},W={class:"history-control"},X=["value"],Z={class:"message",id:"message-box"},ee={class:"role-content",id:"role-content"},te={key:0,class:"role-img",style:{"margin-left":"8px"},src:Y},se={key:1,class:"role-img",src:$,style:{"margin-right":"8px"}},ne=["innerHTML"],oe=["innerHTML"],ae={class:"footer"},le={__name:"home",setup(e){const s=G();l(!1);const n=l(""),p=l("deepseek-ai/DeepSeek-R1"),M=l(!1),h=l(null);let g=new AbortController;const A=l([{value:"Qwen/QwQ-32B",text:"Qwen/QwQ-32B"},{value:"deepseek-ai/DeepSeek-R1-Distill-Qwen-32B",text:"deepseek-ai/DeepSeek-R1-Distill-Qwen-32B"},{value:"deepseek-ai/DeepSeek-R1-Distill-Qwen-7B",text:"deepseek-ai/DeepSeek-R1-Distill-Qwen-7B"},{value:"deepseek-ai/DeepSeek-R1",text:"deepseek-ai/DeepSeek-R1"},{value:"deepseek-ai/DeepSeek-V3",text:"deepseek-ai/DeepSeek-V3"}]),c=l([...s.list]);N(()=>{h.value=document.getElementById("role-content"),x.setOptions({highlight:a=>hljs.highlightAuto(a).value,sanitize:!0}),y()}),O(()=>{g.abort()});const Q=a=>x(a),y=()=>{q(()=>{h.value&&setTimeout(()=>{h.value.scrollTo({top:h.value.scrollHeight,behavior:"smooth"})},0)})},L=()=>{confirm("确定要清空所有聊天记录吗？")&&(s.clearMessages(),c.value=[])},m=l(!1),R=async()=>{if(n.value.trim()&&!m.value){m.value=!0;try{M.value=!0,g=new AbortController,s.userAddMsg(n.value),c.value=[...s.list],s.addAssistantMessage("",""),c.value=s.list;const a=s.formattedContext,v=(await fetch("https://api.siliconflow.cn/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer sk-ikbdqintkdjvvzouoofbxilnrhcordukkducqdmhttwzhwtj","Content-Type":"application/json"},body:JSON.stringify({model:p.value,stream:!0,temperature:.7,top_p:.7,top_k:50,frequency_penalty:.5,n:1,messages:[{role:"system",content:"请根据对话历史提供专业准确的回答"},...a,{role:"user",content:n.value}]}),signal:g.signal})).body.getReader(),t=new TextDecoder;let d="";for(;;){const{done:V,value:H}=await v.read();if(V)break;d+=t.decode(H,{stream:!0});const w=d.split("data: ");d=w.pop()||"";for(const I of w){const b=I.trim();if(b)try{const S=JSON.parse(b).choices[0].delta,_=c.value[c.value.length-1];_.role==="assistant"&&(_.content+=S.content||"",_.reasoning_content+=S.reasoning_content||"",c.value=[...s.list],y())}catch(D){console.error("解析错误:",D)}}}}catch(a){a.name!=="AbortError"&&console.error("请求失败:",a)}finally{M.value=!1,n.value="",m.value=!1}}};return(a,u)=>{const v=J("highlight");return r(),i("div",K,[o("div",W,[o("span",null,[u[2]||(u[2]=E(" 模型： ")),f(o("select",{"onUpdate:modelValue":u[0]||(u[0]=t=>p.value=t),class:"model-select"},[(r(!0),i(C,null,T(A.value,t=>(r(),i("option",{value:t.value},P(t.text),9,X))),256))],512),[[U,p.value]])]),o("button",{class:"clear-btn",onClick:L},"清空记录")]),o("div",Z,[o("div",ee,[(r(!0),i(C,null,T(c.value,(t,d)=>(r(),i("div",{key:d,class:B({user:t.role==="user",assistant:t.role==="assistant"})},[t.role==="user"?(r(),i("img",te)):k("",!0),t.role==="assistant"?(r(),i("img",se)):k("",!0),o("div",null,[t.role==="assistant"?(r(),i("div",{key:0,class:"content-html ass1",innerHTML:t.reasoning_content},null,8,ne)):k("",!0),f(o("div",{class:B(["content-html",t.role==="assistant"?"ass":"us"]),innerHTML:Q(t.content)},null,10,oe),[[v]])])],2))),128))])]),o("div",ae,[f(o("textarea",{rows:"5",placeholder:"请输入问题",class:"text","onUpdate:modelValue":u[1]||(u[1]=t=>n.value=t)},null,512),[[F,n.value]]),o("button",{class:"btn",onClick:R},"发送")])])}}},ce=z(le,[["__scopeId","data-v-a01a2313"]]);export{ce as default};
